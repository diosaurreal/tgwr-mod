add_namespace = ww1_xinjiang

# ASSASSINATE YANG ZENGXIN
#############################
country_event = {
	id = ww1_xinjiang.1
	title = ww1_xinjiang.1.t
	desc = ww1_xinjiang.1.d
	picture = GFX_report_event_generic_funeral
	trigger = {
		has_country_leader = {
			character = CHI_yang_zengxin
			ruling_only = no
		}
		any_other_country = {
			has_country_flag = CHI_kuomintang_flag
			controls_state = 598
		}
	}
	fire_only_once = yes
	mean_time_to_happen = { days = 40 }
	option = {
		name = ww1_xinjiang.1.a
		retire_character = CHI_yang_zengxin
		SIK_jin_shuren = {
			promote_character = warlordism
			promote_character = stratocracy
		}
	}
}

# DEATH OF MAQSUD SHAH
#########################
country_event = {
	id = ww1_xinjiang.2
	title = ww1_xinjiang.2.t
	desc = ww1_xinjiang.2.d
	picture = GFX_report_event_generic_funeral
	trigger = {
		owns_state = 619
		date > 1930.6.1
	}
	fire_only_once = yes
	mean_time_to_happen = { days = 6 }
	immediate = {
		hidden_effect = {
			KUM = {
				if = {
					limit = {
						has_character = KUM_maqsud_shah
					}
					retire_character = KUM_maqsud_shah
					KUM_nasir_shah = {
						promote_character = reactionism
						promote_character = absolute_monarchy
					}
				}
			}
			if = {
				limit = {
					country_exists = SIK
				}
				SIK = { country_event = ww1_xinjiang.2 }
			}
		}
	}
	option = {
		name = ww1_xinjiang.2.a
		trigger = {
			original_tag = KUM
		}
		effect_tooltip = {
			retire_character = KUM_maqsud_shah
			promote_character = KUM_nasir_shah
		}
		add_stability = -0.1
	}
	option = {
		name = ww1_xinjiang.2.b
		trigger = {
			NOT = { original_tag = KUM }
		}
		effect_tooltip = {
			KUM = { retire_character = KUM_maqsud_shah }
		}
		unlock_decision_tooltip = CHI_SIK_annex_KUM
	}
}

# KUMUL REBELLION
######################
country_event = {
	id = ww1_xinjiang.3
	title = ww1_xinjiang.3.t
	desc = ww1_xinjiang.3.d
	picture = GFX_report_event_chinese_soldiers_mountain
	trigger = {
		619 = { is_owned_and_controlled_by = ROOT }
		is_china_or_warlord_no_tt = yes
		NOT = {
			country_exists = KUM
			has_government = communism
			has_government = democratic
			has_global_flag = kumul_rebellion
		}
		date > 1930.1.1
	}
	fire_only_once = yes
	mean_time_to_happen = {
		days = 40
	}
	option = {
		name = ww1_xinjiang.3.a
		set_global_flag = kumul_rebellion
		if = {
			limit = {
				original_tag = SIK
			}
			add_political_power = -125
			else = {
				add_political_power = -40
			}
		}
		remove_state_core = 619
		add_state_claim = 619
		619 = {
			start_resistance = yes
			add_resistance = 40
		}
		KUM = {
			KUM_yulbars_khan = {
				if = {
					limit = {
						has_ideology = absolute_monarchy
					}
					promote_character = absolute_monarchy
				}
				else = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = absolute_monarchy
						}
					}
				}
				if = {
					limit = {
						has_ideology = reactionism
					}
					promote_character = reactionism
				}
				else = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = reactionism
						}
					}
				}
			}
		}
	}
}

# Xinjiang Collapses
country_event = {
	id = ww1_xinjiang.4
	title = ww1_xinjiang.4.t
	desc = ww1_xinjiang.4.d
	picture = GFX_report_event_chinese_soldiers_fighting
	fire_only_once = yes
	trigger = {
		has_global_flag = kumul_rebellion
		tag = SIK
		has_war = no
		is_subject = no
		NOT = {
			country_exists = ETS
			has_country_leader = {
				character = CHI_yang_zengxin
				ruling_only = yes
			}
		}
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					owns_state = 982
				}
				330 = {
					owner = {
						transfer_state = 982
					}
				}
			}
			every_state = {
				limit = {
					region = 145
				}
				add_core_of = ETS
				add_core_of = TGC
				add_core_of = KUM
				add_core_of = SIK
				add_claim_by = ETS
				add_claim_by = TGC
				add_claim_by = KUM
				add_claim_by = SIK
			}
			every_possible_country = {
				limit = {
					has_character = SIK_mehmut_muhiti
				}
				SIK_mehmut_muhiti = {
					set_nationality = ETS
				}
			}
			every_possible_country = {
				limit = {
					has_character = KUM_khoja_niyaz
				}
				KUM_khoja_niyaz = {
					set_nationality = ETS
				}
			}
			every_possible_country = {
				limit = {
					has_character = XSM_ma_zhongying
				}
				XSM_ma_zhongying = {
					set_nationality = TGC
				}
			}
			every_possible_country = {
				limit = {
					has_character = XSM_ma_hushan
				}
				XSM_ma_hushan = {
					set_nationality = TGC
				}
			}
			ETS = {
				add_ideas = standing_alone
				inherit_technology = ROOT
				KUM_khoja_niyaz = {
					if = {
						limit = {
							has_ideology = conservatism
						}
						promote_character = conservatism
					}
					else = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = conservatism
							}
						}
					}
					if = {
						limit = {
							has_ideology = agrarian_socialism
						}
						promote_character = agrarian_socialism
					}
					else = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = agrarian_socialism
							}
						}
					}
					if = {
						limit = {
							has_ideology = revolutionary_nationalism
						}
						promote_character = revolutionary_nationalism
					}
					else = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = revolutionary_nationalism
							}
						}
					}
				}
				transfer_state = 749
				division_template = {
					name = "Sherqiy Türkistan Partizanliri"
					division_names_group = SIK_GAR_01
					regiments = {
						militia = { x = 0 y = 0 }
						militia = { x = 0 y = 1 }
						militia = { x = 1 y = 0 }
						militia = { x = 1 y = 1 }
						militia = { x = 2 y = 0 }
						militia = { x = 2 y = 1 }
						militia = { x = 3 y = 0 }
						militia = { x = 3 y = 1 }
					}
				}
				capital_scope = {
					create_unit = {
						division = "division_template = \"Sherqiy Türkistan Partizanliri\"	start_experience_factor = 0.2	start_equipment_factor = 0.7"
						owner = PREV
						allow_spawning_on_enemy_provs = yes
						count = 6
					}
				}
			}
			KUM = {
				transfer_state = 619
				add_ideas = standing_alone
				inherit_technology = ROOT
				division_template = {
					name = "Qumul Partizanliri"
					division_names_group = SIK_GAR_01
					regiments = {
						irregular_infantry = { x = 0 y = 0 }
						irregular_infantry = { x = 0 y = 1 }
						irregular_infantry = { x = 1 y = 0 }
						irregular_infantry = { x = 1 y = 1 }
						irregular_infantry = { x = 2 y = 0 }
						irregular_infantry = { x = 2 y = 1 }
						irregular_infantry = { x = 3 y = 0 }
						irregular_infantry = { x = 3 y = 1 }
					}
				}
				capital_scope = {
					create_unit = {
						division = "division_template = \"Qumul Partizanliri\"	start_experience_factor = 0.4	start_equipment_factor = 0.8"
						owner = PREV
						allow_spawning_on_enemy_provs = yes
						count = 2
					}
				}
			}
			TGC = {
				XSM_ma_hushan = {
					if = {
						limit = {
							has_ideology = warlordism
						}
						promote_character = warlordism
					}
					else = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = warlordism
								traits = { king_tunganistan }
							}
						}
					}
					if = {
						limit = {
							has_ideology = stratocracy
						}
						promote_character = stratocracy
					}
					else = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = stratocracy
								traits = { king_tunganistan }
							}
						}
					}
				}
				XSM_ma_zhongying = {
					if = {
						limit = {
							has_ideology = warlordism
						}
						promote_character = warlordism
					}
					else = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = warlordism
								traits = { thunder_general }
							}
						}
					}
					if = {
						limit = {
							has_ideology = stratocracy
						}
						promote_character = stratocracy
					}
					else = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = stratocracy
								traits = { thunder_general }
							}
						}
					}
				}
				transfer_state = 894
				transfer_state = 1067
				add_ideas = standing_alone
				inherit_technology = ROOT
				division_template = {
					name = "Hoten Huijun"
					division_names_group = SIK_INF_01
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
						field_gun_brigade = { x = 0 y = 3 }
						infantry = { x = 1 y = 0 }
						infantry = { x = 1 y = 1 }
						infantry = { x = 1 y = 2 }
						field_gun_brigade = { x = 1 y = 3 }
						infantry = { x = 2 y = 0 }
						infantry = { x = 2 y = 1 }
						infantry = { x = 2 y = 2 }
						field_gun_brigade = { x = 2 y = 3 }
						infantry = { x = 3 y = 0 }
						infantry = { x = 3 y = 1 }
						infantry = { x = 3 y = 2 }
						cavalry = { x = 4 y = 0 }
						cavalry = { x = 4 y = 1 }
						cavalry = { x = 4 y = 2 }
					}
					support = {
						engineer = { x = 0 y = 0 }
					}
				}
				capital_scope = {
					create_unit = {
						division = "division_template = \"Hoten Huijun\"	start_experience_factor = 0.7	start_equipment_factor = 1"
						owner = PREV
						allow_spawning_on_enemy_provs = yes
						count = 8
					}
				}
			}
			set_global_flag = xinjiang_collapsed
			ETS = {
				declare_war_on = {
					target = ROOT
					type = independence_wargoal
				}
			}
			KUM = {
				declare_war_on = {
					target = ROOT
					type = independence_wargoal
				}
			}
			TGC = {
				declare_war_on = {
					target = ROOT
					type = annex_everything
				}
			}
		}
	}
	option = {
		name = ww1_xinjiang.4.a
		effect_tooltip = {
			ETS = {
				declare_war_on = {
					target = ROOT
					type = independence_wargoal
				}
			}
			KUM = {
				declare_war_on = {
					target = ROOT
					type = independence_wargoal
				}
			}
			TGC = {
				declare_war_on = {
					target = ROOT
					type = annex_everything
				}
			}
		}
	}
}

# TIHWA COUP
######################
country_event = {
	id = ww1_xinjiang.5
	title = ww1_xinjiang.5.t
	desc = ww1_xinjiang.5.d
	picture = GFX_report_event_chinese_soldiers_fighting
	trigger = {
		tag = SIK
		has_country_leader = {
			character = SIK_jin_shuren
			ruling_only = yes
		}
		has_character = SIK_sheng_shicai
		has_global_flag = xinjiang_collapsed
		OR = {
			surrender_progress > 0.25
			NOT = { controls_province = 10614 }
		}
	}
	fire_only_once = yes
	mean_time_to_happen = { days = 0 }
	option = {
		name = ww1_xinjiang.5.a
		retire_character = SIK_jin_shuren
		SIK_sheng_shicai = {
			if = {
				limit = {
					has_ideology = warlordism
				}
				promote_character = warlordism
			}
			else = {
				add_country_leader_role = {
					promote_leader = yes
					country_leader = {
						ideology = warlordism
						traits = { xinjiang_king }
					}
				}
			}
			hidden_effect = {
				if = {
					limit = {
						has_ideology = vanguardism
					}
					promote_character = vanguardism
				}
				else = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = vanguardism
							traits = { xinjiang_king }
						}
					}
				}
				if = {
					limit = {
						has_ideology = stratocracy
					}
					promote_character = stratocracy
				}
				else = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = stratocracy
							traits = { xinjiang_king }
						}
					}
				}
			}
		}
		every_enemy_country = {
			limit = {
				OR = {
					original_tag = KUM
					original_tag = ETS
					original_tag = TGC
				}
			}
			if = {
				limit = {
					OR = {
						original_tag = KUM
						original_tag = ETS
					}
				}
				white_peace = ROOT
				get_current_government_type = yes
				ROOT = {
					set_autonomy = {
						target = PREV
						autonomy_state = autonomy_integrated_puppet
					}
				}
				restore_previous_government_type = yes
				add_to_war = {
					targeted_alliance = ROOT
					enemy = TGC
				}
			}
		}
	}
}

# DEATH OF MA QI
###################
country_event = {
	id = ww1_xinjiang.6
	title = ww1_xinjiang.6.t
	desc = ww1_xinjiang.6.d
	picture = GFX_report_event_generic_funeral
	trigger = {
		date > 1931.8.1
		has_country_leader = {
			character = CHI_ma_qi
			ruling_only = no
		}
	}
	fire_only_once = yes
	mean_time_to_happen = { days = 5 }
	option = {
		name = ww1_xinjiang.6.a
		retire_character = CHI_ma_qi
		XSM_ma_lin = {
			promote_character = stratocracy
			promote_character = warlordism
		}
	}
}

# Ili Provisional Trade Agreement of 1920 - Chinese decision
country_event = {
	id = ww1_xinjiang.7
	title = ww1_xinjiang.7.t
	desc = ww1_xinjiang.7.d
	picture = GFX_report_event_chinese_street
	fire_only_once = yes
	trigger = {
		tag = SIK
		is_subject = no
		SOV = {
			is_neighbor_of_subject = yes
			has_russian_civil_war = no
			NOT = {
				has_war_with = ROOT
			}
		}
	}
	option = {
		name = ww1_xinjiang.7.a
		custom_effect_tooltip = if_they_accept
		effect_tooltip = {
			give_market_access = SOV
			add_opinion_modifier = {
				target = SOV
				modifier = improve_relation
			}
			SOV = {
				add_opinion_modifier = {
					target = SOV
					modifier = improve_relation
				}
			}
			every_owned_state = {
				limit = {
					OR = {
						state = 287
						state = 618
					}
					can_construct_building = industrial_complex
				}
				add_building_construction = {
					type = industrial_complex
					level = 1
					instant_build = yes
				}
			}
		}
		hidden_effect = {
			SOV = { country_event = { id = ww1_xinjiang.10 days = 3 } }
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 10
				has_government = SOV
			}
			modifier = {
				add = 5
				has_country_leader = {
					character = CHI_yang_zengxin
				}
			}
		}
	}
	option = {
		name = ww1_xinjiang.7.b
		add_political_power = -25
		ai_chance = {
			base = 5
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
	}
}

# Soviet Intervenes Sinkiang
country_event = {
	id = ww1_xinjiang.8
	title = ww1_xinjiang.8.t
	desc = ww1_xinjiang.8.d
	picture = GFX_report_event_chinese_soviet
	is_triggered_only = yes
	option = {
		name = ww1_xinjiang.8.a
		ai_chance = { base = 100 }
		FROM = {
			set_country_flag = protectorate
			every_enemy_country = {
				limit = {
					NOT = {
						has_war_with = ROOT
					}
				}
				if = {
					limit = {
						OR = {
							original_tag = TGC
							original_tag = ETS
							original_tag = KUM
						}
					}
					if = {
						limit = {
							is_in_faction = yes
						}
						leave_faction = yes
					}
					if = {
						limit = {
							is_subject = yes
						}
						OVERLORD = {
							end_puppet = PREV
						}
					}
				}
				white_peace = PREV
				country_event = {
					id = ww1_xinjiang.9
					hours = 3
				}
			}
		}
		set_autonomy = {
			target = FROM
			autonomy_state = autonomy_tgwr_informal_protectorate
			end_wars = yes
		}
		hidden_effect = {
			FROM = {
				set_politics = {
					ruling_party = communism
					elections_allowed = no
				}
				set_popularities = {
					communism = 42
					neutrality = 30
					fascism = 28
				}
				if = {
					limit = {
						is_in_faction = yes
					}
					leave_faction = yes
				}
				every_subject_country = {
					PREV = { end_puppet = PREV }
				}
			}
		}
	}
	option = {
		name = ww1_xinjiang.8.b
		ai_chance = { base = 0 }
	}
}

# Soviet Intervenes Sinkiang - notice
country_event = {
	id = ww1_xinjiang.9
	title = ww1_xinjiang.9.t
	desc = ww1_xinjiang.9.d
	picture = GFX_report_event_chinese_soviet
	is_triggered_only = yes
	option = {
		name = ww1_xinjiang.9.a
		add_political_power = -25
	}
	option = {
		name = ww1_xinjiang.9.b
		declare_war_on = {
			target = FROM
			type = take_core_state
		}
		ai_chance = { base = 0 }
	}
}

# Ili Provisional Trade Agreement of 1920 - Soviet choice
country_event = {
	id = ww1_xinjiang.10
	title = ww1_xinjiang.10.t
	desc = ww1_xinjiang.10.d
	picture = GFX_report_event_chinese_street
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		FROM = {
			is_neighbor_of_subject = yes
		}
		NOT = {
			has_war_with = FROM
		}
	}
	option = {
		name = ww1_xinjiang.10.a
		give_market_access = FROM
		add_opinion_modifier = {
			target = FROM
			modifier = improve_relation
		}
		FROM = {
			add_opinion_modifier = {
				target = ROOT
				modifier = improve_relation
			}
			every_owned_state = {
				limit = {
					OR = {
						state = 287
						state = 618
					}
					can_construct_building = industrial_complex
				}
				add_building_construction = {
					type = industrial_complex
					level = 1
					instant_build = yes
				}
			}
		}
		ai_chance = {
			base = 5
			modifier = {
				add = 10
				has_government = FROM
			}
			modifier = {
				add = 5
				has_country_leader = {
					character = CHI_yang_zengxin
				}
			}
		}
	}
	option = {
		name = ww1_xinjiang.10.b
		ai_chance = {
			base = 5
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
	}
}

# Ma Fuxiang joins Guominjun
country_event = {
	id = ww1_xinjiang.11
	title = ww1_xinjiang.11.t
	desc = ww1_xinjiang.11.d
	picture = GFX_report_event_chinese_soldiers
	fire_only_once = yes
	trigger = {
		has_country_leader = {
			character = CHI_ma_fuxiang
			ruling_only = yes
		}
		is_subject = no
		OR = {
			has_war_with = GMJ
			is_neighbor_of = GMJ
		}
		NOT = {
			has_country_flag = reunited_china
		}
	}
	mean_time_to_happen = {
		days = 0
	}
	option = {
		name = ww1_xinjiang.11.a
		CHI_ma_fuxiang = {
			remove_country_leader_role = {
				ideology = warlordism
			}
			remove_country_leader_role = {
				ideology = stratocracy
			}
			set_nationality = GMJ
		}
		white_peace = GMJ
		every_owned_state = {
			limit = {
				NOT = {
					state = 283
					state = 604
					state = 616
					state = 755
				}
			}
			if = {
				limit = {
					is_core_of = ROOT
				}
				remove_core_of = ROOT
				add_core_of = GMJ
			}
			transfer_state_to = GMJ
		}
	}
}

# Ma Hongbin joins Guominjun
country_event = {
	id = ww1_xinjiang.12
	title = ww1_xinjiang.12.t
	desc = ww1_xinjiang.12.d
	picture = GFX_report_event_chinese_soldiers
	fire_only_once = yes
	trigger = {
		tag = GAN
		has_war = no
		is_subject = no
		GMJ = {
			has_war = no
			is_neighbor_of = ROOT
			NOT = { has_government = communism }
		}
		NOT = {
			has_country_leader = {
				character = CHI_ma_fuxiang
				ruling_only = yes
			}
			has_country_flag = reunited_china
			has_government = communism
		}
	}
	mean_time_to_happen = {
		days = 40
	}
	option = {
		name = ww1_xinjiang.12.b
		# trigger = { is_ai = no }
		XSM_ma_hongbin = {
			set_nationality = GMJ
		}
		XSM_ma_hongkui = {
			set_nationality = GMJ
		}
		GMJ = {
			every_state = {
				limit = {
					is_core_of = ROOT
				}
				remove_core_of = ROOT
				add_core_of = PREV
			}
			annex_country = {
				target = ROOT
				transfer_troops = yes
			}
			if = {
				limit = {
					ROOT = { is_ai = no }
					is_ai = yes
				}
				change_tag_from = ROOT
			}
		}
	}
}

# 1912 Kumul Uprising
country_event = {
	id = ww1_xinjiang.13
	title = ww1_xinjiang.13.t
	desc = ww1_xinjiang.13.d
	picture = GFX_report_event_gathering_protest
	fire_only_once = yes
	trigger = {
		is_china_or_warlord_no_tt = yes
		controls_state = 619
		date > 1912.1.1
		has_start_date < 1914.1.1
	}
	mean_time_to_happen = {
		days = 120
	}
	option = {
		name = ww1_xinjiang.13.a
		add_political_power = -5
	}
}

# Death of Ma Fuxiang
country_event = {
	id = ww1_xinjiang.14
	title = ww1_xinjiang.14.t
	desc = ww1_xinjiang.14.d
	picture = GFX_report_event_generic_funeral
	fire_only_once = yes
	trigger = {
		has_character = CHI_ma_fuxiang
		date > 1932.8.1
	}
	mean_time_to_happen = {
		days = 20
	}
	option = {
		name = ww1_xinjiang.14.a
		retire_character = CHI_ma_fuxiang
	}
}