add_namespace = ww1_tibet

#New Flag
country_event = {
	id = ww1_tibet.1
	title = ww1_tibet.1.t
	desc = ww1_tibet.1.d	
	picture = GFX_report_event_generic_read_write
	
	fire_only_once = yes

	trigger = {
		original_tag = TIB
		date > 1916.1.1
		has_government = neutrality
		NOT = {
			has_cosmetic_tag = TIB_1916
		}	
	}

	mean_time_to_happen = { days = 50 }
	
	option = {
		name = ww1_tibet.1.a
		set_cosmetic_tag = TIB_1916
	}
}

#Death of 13th Dalai Lama
country_event = {
	id = ww1_tibet.2
	title = ww1_tibet.2.t
	desc = ww1_tibet.2.d	
	picture = GFX_report_event_royal_parade
	
	fire_only_once = yes

	trigger = {
		tag = TIB	
		date > 1933.12.1
		has_government = neutrality
		has_character = TIB_dalai_lama_thubten_gyatso
	}

	mean_time_to_happen = { days = 17 }
	
	option = {
		name = ww1_tibet.2.a
		retire_character = TIB_dalai_lama_thubten_gyatso
		promote_character = TIB_jamphel_yeshe_gyaltsen
	}
}

# Simla Convention
country_event = {
	id = ww1_tibet.3
	title = ww1_tibet.3.t
	desc = ww1_tibet.3.d
	picture = GFX_report_event_generic_conference
	trigger = {
		owns_state = 432
		is_china_or_warlord_no_tt = no
		NOT = {
			original_tag = TIB
			has_war_with = TIB
			any_enemy_country = {
				is_china_or_warlord_no_tt = yes
			}
		}
		TIB = {
			is_subject = no
			owns_state = 434
		}
		date > 1913.10.13
		has_start_date < 1914.1.1
	}
	fire_only_once = yes
	option = {
		name = ww1_tibet.3.a
		608 = {
			owner = {
				country_event = {
					id = ww1_tibet.4
					days = 10
				}
			}
		}
		434 = {
			owner = {
				country_event = {
					id = ww1_tibet.4
					days = 10
				}
			}
		}
	}
}

# Simla Convention - The British Raj Invites
country_event = {
	id = ww1_tibet.4
	title = ww1_tibet.4.t
	desc = ww1_tibet.4.d
	picture = GFX_report_event_generic_conference
	is_triggered_only = yes
	trigger = {
		OR = {
			owns_state = 434
			owns_state = 608
		}
	}
	option = {
		name = ww1_tibet.4.a
		if = {
			limit = {
				original_tag = TIB
			}
			custom_effect_tooltip = historical_tt
		}
		hidden_effect = {
			country_event = {
				id = ww1_tibet.5
				days = 120
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 10
				is_guaranteed_by = FROM
			}
		}
	}
	option = {
		name = ww1_tibet.4.b
		if = {
			limit = {
				is_china_or_warlord_no_tt = yes
			}
			custom_effect_tooltip = historical_tt
		}
		set_global_flag = simla_convention_reject
		hidden_effect = {
			country_event = {
				id = ww1_tibet.5
				days = 120
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				is_china_or_warlord_no_tt = yes
			}
			modifier = {
				factor = 0
				is_guaranteed_by = FROM
			}
		}
	}
}

# Simla Convention - Outcome
country_event = {
	id = ww1_tibet.5
	title = ww1_tibet.5.t
	desc = {
		text = ww1_tibet.5.d
		trigger = {
			has_global_flag = simla_convention_reject
		}
	}
	desc = {
		text = ww1_tibet.5.e
		trigger = {
			NOT = { has_global_flag = simla_convention_reject }
		}
	}
	picture = GFX_report_event_generic_conference
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					NOT = { has_global_flag = simla_convention_reject }
				}
				set_global_flag = simla_convention
			}
		}
	}
	option = {
		name = ww1_tibet.5.a
		trigger = {
			has_global_flag = simla_convention_reject
		}
		effect_tooltip = {
			432 = {
				owner = {
					add_state_claim = 434
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					owns_state = 432
				}
				add_state_claim = 434
				give_guarantee = TIB
			}
			else_if = {
				limit = {
					owns_state = 322
				}
				432 = {
					owner = {
						country_event = ww1_tibet.5
					}
				}
			}
		}
	}
	option = {
		name = ww1_tibet.5.b
		trigger = {
			NOT = {
				has_global_flag = simla_convention_reject
			}
		}
		effect_tooltip = {
			432 = {
				owner = {
					add_state_core = 434
					transfer_state = 434
					give_guarantee = TIB
					give_market_access = TIB
				}
			}
			608 = {
				owner = {
					give_guarantee = TIB
					give_market_access = TIB
					diplomatic_relation = {
						country = TIB
						relation = non_aggression_pact
						active = yes
					}
					every_state = {
						limit = {
							is_core_of = TIB
							is_claimed_by = PREV
							NOT = {
								state = 1220
							}
						}
						remove_claim_by = PREV
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					owns_state = 432
				}
				add_state_core = 434
				transfer_state = 434
				give_guarantee = TIB
				give_market_access = TIB
			}
			else_if = {
				limit = {
					owns_state = 608
				}
				give_guarantee = TIB
				give_market_access = TIB
				diplomatic_relation = {
					country = TIB
					relation = non_aggression_pact
					active = yes
				}
				every_state = {
					limit = {
						is_core_of = TIB
						is_claimed_by = ROOT
						NOT = {
							state = 1220
						}
					}
					remove_claim_by = ROOT
				}
			}
			else_if = {
				limit = {
					owns_state = 322
				}
				remove_ideas = TIB_de_facto_independence
				432 = {
					owner = {
						country_event = ww1_tibet.5
					}
				}
			}
		}
	}
}


# Tibet Is Attacked, but China recognises as their Territory
country_event = {
	id = ww1_tibet.6
	title = ww1_tibet.6.t
	desc = ww1_tibet.6.d
	picture = GFX_report_event_china_map
	is_triggered_only = yes
	fire_only_once = yes
	option = {
		name = ww1_tibet.6.a
		FROM = {
			every_enemy_country = {
				limit = {
					is_china_or_warlord = no
					NOT = {
						has_war_with = ROOT
					}
				}
				ROOT = {
					add_to_war = {
						targeted_alliance = PREV.PREV
						enemy = PREV
					}
				}
				every_other_country = {
					limit = {
						is_china_or_warlord = yes
						is_ally_with = ROOT
					}
					add_to_war = {
						targeted_alliance = ROOT
						enemy = PREV
					}
				}
			}
		}
		declare_war_on = {
			target = FROM
			type = annex_everything
		}
		ai_chance = {
			base = 5
			modifier = {
				add = 10
				has_war_support > 0.7
			}
			modifier = {
				add = 5
				is_major = yes
			}
			modifier = {
				add = 5
				threat > 0.5
			}
		}
	}
	option = {
		name = ww1_tibet.6.b
		add_political_power = -75
		every_possible_country = {
			limit = {
				is_china_or_warlord = yes
				any_state = {
					is_core_of = TIB
					is_claimed_by = PREV
					NOT = {
						state = 1220
					}
				}
			}
			every_state = {
				limit = {
					is_core_of = TIB
					is_claimed_by = PREV
					NOT = {
						state = 1220
					}
				}
				remove_claim_by = PREV
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 10
				has_war_support < 0.3
			}
			modifier = {
				add = 10
				has_stability < 0.3
			}
		}
	}
}