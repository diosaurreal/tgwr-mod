on_actions = {
	on_startup = {
		effect = {
			ALB = {
				remove_ideas = ALB_albanian_society_idea
				remove_ideas = ALB_illiterate_society_idea
				set_country_flag = TUR_ongoing_rebellion_days
			}
		}
	}
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					ROOT = {
						NOT = { original_tag = ALB }
						OR = {
							NOT = {
								has_country_leader = { character = ALB_vilhelm_i }
								has_country_leader = { character = GER_wilhelm_karl_von_urach }
								has_country_leader = { character = ITA_vittorio_emanuele_di_savoy_aosta }
							}
							is_subject_of = TUR
							is_in_faction_with = TUR
						}
					}
					FROM.FROM = { has_dynamic_modifier = { modifier = ALB_muslim_resistance } }
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = ALB_muslim_resistance }
					set_state_flag = ALB_muslim_resistance_no_control
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = ALB
						NOT = {
							has_global_flag = ALB_muslim_rebellion_end
							is_subject_of = TUR
							is_in_faction_with = TUR
						}
						OR = {
							has_country_leader = { character = ALB_vilhelm_i }
							has_country_leader = { character = GER_wilhelm_karl_von_urach }
							has_country_leader = { character = ITA_vittorio_emanuele_di_savoy_aosta }
							has_war_with = TUR
						}
					}
					FROM.FROM = { has_state_flag = ALB_muslim_resistance_no_control }
				}
				FROM.FROM = {
					add_dynamic_modifier = { modifier = ALB_muslim_resistance }
					clr_state_flag = ALB_muslim_resistance_no_control
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						NOT = { original_tag = ALB }
						OR = {
							NOT = { has_country_leader = { character = EGY_fuad_i_muhammad_ali } }
							is_subject_of = TUR
							is_in_faction_with = TUR
						}
					}
					FROM.FROM = { has_dynamic_modifier = { modifier = ALB_catholic_resistance } }
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = ALB_catholic_resistance }
					set_state_flag = ALB_catholic_resistance_no_control
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = ALB
						NOT = {
							has_global_flag = ALB_catholic_rebellion_end
							is_subject_of = TUR
							is_in_faction_with = TUR
						}
						has_country_leader = { character = EGY_fuad_i_muhammad_ali }
					}
					FROM.FROM = { has_state_flag = ALB_catholic_resistance_no_control }
				}
				FROM.FROM = {
					add_dynamic_modifier = { modifier = ALB_catholic_resistance }
					clr_state_flag = ALB_catholic_resistance_no_control
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { has_country_flag = muslim_albania_focus } }
					FROM.FROM = { has_dynamic_modifier = { modifier = ALB_unruly_catholic_population } }
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = ALB_unruly_catholic_population }
					set_state_flag = ALB_unruly_catholic_population_no_control
				}
			}
			if = {
				limit = {
					ROOT = { has_country_flag = muslim_albania_focus }
					FROM.FROM = { NOT = { has_dynamic_modifier = { modifier = ALB_unruly_catholic_population } } }
				}
				FROM.FROM = {
					add_dynamic_modifier = { modifier = ALB_unruly_catholic_population }
					clr_state_flag = ALB_unruly_catholic_population_no_control
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { has_country_flag = catholic_albania_focus } }
					FROM.FROM = { has_dynamic_modifier = { modifier = ALB_unruly_muslim_population } }
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = ALB_unruly_muslim_population }
					set_state_flag = ALB_unruly_muslim_population_no_control
				}
			}
			if = {
				limit = {
					ROOT = { has_country_flag = catholic_albania_focus }
					FROM.FROM = { NOT = { has_dynamic_modifier = { modifier = ALB_unruly_muslim_population } } }
				}
				FROM.FROM = {
					add_dynamic_modifier = { modifier = ALB_unruly_muslim_population }
					clr_state_flag = ALB_unruly_muslim_population_no_control
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						OR = {
							AND = {
								tag = ITA
								has_global_flag = ALB_pro_italian_government
							}
							AND = {
								tag = AUS
								has_global_flag = ALB_pro_austrian_government
							}
						}
						has_war_with = ALB
					}
					FROM.FROM = { is_core_of = ALB }
				}
				ROOT = { country_event = { id = albania.78 days = 1 random_days = 6 } }
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_dynamic_modifier = { modifier = ALB_committee_for_the_liberation_of_kosova }
						is_core_of = ROOT
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = ALB_committee_for_the_liberation_of_kosova }
					add_dynamic_modifier = { modifier = ALB_committee_for_the_liberation_of_kosova_good }
				}
			}
			if = {
				limit = {
					FROM.FROM = {
						has_dynamic_modifier = { modifier = ALB_committee_for_the_liberation_of_kosova_good }
						NOT = { is_core_of = ROOT }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = ALB_committee_for_the_liberation_of_kosova_good }
					add_dynamic_modifier = { modifier = ALB_committee_for_the_liberation_of_kosova }
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { original_tag = ALB } }
					FROM.FROM = {
						is_core_of = ALB
						OR = {
							is_owned_by = ALB
							has_contested_owner = ALB
						}
						NOT = {
							state = 44
							is_core_of = ROOT
							is_claimed_by = ROOT
						}
					}
				}
				set_variable = { ROOT.albanian_capital_for_protectorate = FROM.FROM }
			}
		}
	}
	on_capitulation = {
		effect = {
			if = {
				limit = {
					ROOT = { has_idea = ALB_decentralized_independence_movement }
					has_country_flag = TUR_revolting_country
				}
				if = {
					limit = { has_country_flag = ALB_abdulhamid_government }
					country_event = albania.20
				}
				if = {
					limit = { has_country_flag = ALB_prizren_government }
					country_event = albania.1
				}
				if = {
					limit = { has_country_flag = ALB_kimza_government }
					country_event = albania.2
				}
				if = {
					limit = { has_country_flag = ALB_toptani_government }
					country_event = albania.3
				}
				if = {
					limit = { has_country_flag = ALB_vlora_government }
					country_event = albania.4
				}
				if = {
					limit = { is_government_in_exile = no }
					if = {
						limit = {
							MNT = {
								NOT = { has_war_with = ROOT }
								any_owned_state = {
									is_controlled_by = MNT
									any_neighbor_state = { is_core_of = ROOT }
								}
							}
						}
						ROOT = {
							become_exiled_in = {
								target = MNT
								legitimacy = 35
							}
							MNT = { ROOT = { country_event = albania.6 } }
						}
					}
					else_if = {
						limit = {
							SER = {
								NOT = { has_war_with = ROOT }
								any_owned_state = {
									is_controlled_by = SER
									any_neighbor_state = { is_core_of = ROOT }
								}
							}
						}
						ROOT = {
							become_exiled_in = {
								target = SER
								legitimacy = 35
							}
							SER = { ROOT = { country_event = albania.6 } }
						}
					}
					else_if = {
						limit = {
							GRE = {
								NOT = { has_war_with = ROOT }
								any_owned_state = {
									is_controlled_by = GRE
									any_neighbor_state = { is_core_of = ROOT }
								}
							}
						}
						ROOT = {
							become_exiled_in = {
								target = GRE
								legitimacy = 35
							}
							GRE = { ROOT = { country_event = albania.6 } }
						}
					}
					else = {
						random_country = {
							limit = {
								NOT = { has_war_with = ROOT }
								any_owned_state = {
									is_controlled_by = PREV
									any_neighbor_state = { is_core_of = ROOT }
								}
							}
							ROOT = {
								become_exiled_in = {
									target = PREV
									legitimacy = 35
								}
								PREV = { ROOT = { country_event = albania.6 } }
							}
						}
					}
					if = {
						limit = {
							any_other_country = {
								is_in_faction = yes
								is_hosting_exile = ROOT
							}
							ROOT = { NOT = { has_rule = can_join_factions } }
						}
						ROOT = { leave_faction = yes }
					}
				}
			}
		}
	}
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					OR = {
						NOT = { country_exists = ALB }
						ALB = { has_country_flag = TUR_revolting_country }
					}
					FROM.FROM = { check_variable = { TUR_albanian_state_level > 0 } }
					ROOT = {
						OR = {
							tag = SER
							tag = MNT
							tag = GER
							is_in_faction_with = SER
							is_in_faction_with = MNT
							is_in_faction_with = GRE
						}
					}
					FROM = { original_tag = TUR }
				}
				TUR = { country_event = { id = ottoman.88 days = 2 } }
			}
		}
		effect = { #albanians save abdulhamid II
			if = {
				limit = {
					ROOT = {
						original_tag = ALB
						has_country_flag = TUR_revolting_country
						OR = {
							ALB_riza_gjakova = {
								OR = {
									is_leading_army = yes
									is_leading_army_group = yes
									is_country_leader = yes
								}
							}
							ALB_isa_boletini = {
								OR = {
									is_leading_army = yes
									is_leading_army_group = yes
									is_country_leader = yes
								}
							}
						}
					}
					FROM.FROM = { state = 345 }
				}
				ROOT = { country_event = { id = albania.11 hours = 2 } }
			}
		}
		effect = {
			if = {
				limit = {
					has_global_flag = ALB_defending_our_homeland
					ALB = {
						OR = {
							all_core_state = { NOT = { is_controlled_by = TUR } }
							has_capitulated = no
						}
					}
				}
				TUR = { country_event = { id = albania.43 } }
			}
		}
	}
	on_daily_ALB = {
		effect = {
			if = {
				limit = { any_controlled_state = { has_dynamic_modifier = { modifier = TUR_vilayet_centralization } } }
				TUR_vilayet_centralization_garrison_effect = yes
			}
		}
		effect = {
			if = {
				limit = { has_dynamic_modifier = { modifier = ALB_sublime_realm } }
				TUR_minority_revolt_effect = yes
			}
		}
		effect = { ALB_tax_on_foreign_troops_effect = yes }
	}
	on_war_relation_added = {
		effect = {
			if = {
				limit = {
					ROOT = {
						tag = ALB
						NOT = { has_country_flag = TUR_revolting_country }
						owns_state = 1215
						NOT = { has_active_mission = ALB_muslim_rebellion_mission }
					}
					FROM = {
						tag = TUR
						#has_caliph = yes
					}
				}
				if = {
					limit = { has_global_flag = ALB_muslim_rebellion_end }
					clr_global_flag = ALB_muslim_rebellion_end
				}
				country_event = { id = albania.60 hours = 6 }
			}
		}
		effect = {
			if = {
				limit = {
					FROM = {
						OR = {
							AND = {
								original_tag = ALB
								has_idea = ALB_albanian_jihad
								NOT = { has_idea = ALB_albanian_jihad_yes }
							}
							AND = {
								is_major = yes
								has_war_with = ROOT
							}
						}
					}
					ROOT = {
						OR = {
							AND = {
								original_tag = ALB
								has_idea = ALB_albanian_jihad
								NOT = { has_idea = ALB_albanian_jihad_yes }
							}
							AND = {
								is_major = yes
								has_war_with = ROOT
							}
						}
					}
				}
				if = {
					limit = { has_idea = ALB_albanian_jihad }
					add_ideas = ALB_albanian_jihad_yes
				}
			}
		}
	}
	on_peace = {
		effect = {
			if = {
				limit = { has_idea = ALB_albanian_jihad_yes }
				remove_ideas = ALB_albanian_jihad_yes
			}
		}
	}
	on_peaceconference_started = {
		effect = {
			if = {
				limit = {
					has_idea = ALB_albanian_jihad_yes
					NOT = { any_enemy_country = { is_major = yes } }
				}
				remove_ideas = ALB_albanian_jihad_yes
			}
		}
	}
	on_civil_war_end_before_annexation = { #albania character nationality changes
		effect = {
			if = {
				limit = {
					ROOT = { original_tag = ALB }
					FROM = { original_tag = ALB }
				}
				FROM = {
					every_character = {
						limit = {
							NOT = {
								is_character = ALB_vilhelm_i
								is_character = GER_wilhelm_karl_von_urach
								is_character = ITA_vittorio_emanuele_di_savoy_aosta
								is_character = EGY_fuad_i_muhammad_ali
							}
						}
						set_nationality = ROOT
					}
				}
				if = {
					limit = {
						ROOT = {
							OR = {
								has_country_flag = muslim_albania_focus
								has_country_flag = catholic_albania_focus
							}
						}
						FROM = { original_tag = ALB }
					}
					if = {
						limit = { has_character = ALB_vilhelm_i }
						ALB_vilhelm_i = { set_nationality = GER }
					}
					if = {
						limit = { has_character = GER_wilhelm_karl_von_urach }
						GER_wilhelm_karl_von_urach = { set_nationality = GER }
					}
					if = {
						limit = { has_character = ITA_vittorio_emanuele_di_savoy_aosta }
						ITA_vittorio_emanuele_di_savoy_aosta = { set_nationality = ITA }
					}
					if = {
						limit = { has_character = EGY_fuad_i_muhammad_ali }
						EGY_fuad_i_muhammad_ali = { set_nationality = EGY }
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { original_tag = EPR }
					FROM = { original_tag = ALB }
					OR = {
						ROOT = {
							has_war_with_wargoal_against = {
								target = FROM
								type = independence_wargoal
							}
						}
						FROM = {
							has_war_with_wargoal_against = {
								target = ROOT
								type = annex_everything
							}
						}
					}
				}
				ROOT = { white_peace = FROM }
			}
		}
	}
	on_civil_war_end = {
		effect = {
			if = {
				limit = {
					ROOT = { has_country_flag = muslim_albania_focus }
					owns_state = 870
				}
				ROOT = { country_event = { id = albania.80 days = 1 random_days = 3 } }
			}
			if = {
				limit = {
					ROOT = { has_country_flag = catholic_albania_focus }
					owns_state = 1215
				}
				ROOT = { country_event = { id = albania.81 days = 1 random_days = 3 } }
			}
			if = {
				limit = {
					OR = {
						has_country_flag = ALB_contact_the_hoti_tribe
						has_country_flag = ALB_contact_the_kelmendi_tribe
						has_country_flag = ALB_contact_the_shkreli_tribe
						has_country_flag = ALB_contact_the_kastrati_tribe
						has_country_flag = ALB_contact_the_gruda_tribe
						has_country_flag = ALB_contact_the_shala_tribe
						has_country_flag = ALB_contact_the_mat_tribe
					}
				}
				delete_unit_template_and_units = {
					division_template = "Forcat Fisnore"
					disband = no
				}
				if = {
					limit = { has_country_flag = ALB_contact_the_hoti_tribe }
					clr_country_flag = ALB_contact_the_hoti_tribe
				}
				if = {
					limit = { has_country_flag = ALB_contact_the_kelmendi_tribe }
					clr_country_flag = ALB_contact_the_kelmendi_tribe
				}
				if = {
					limit = { has_country_flag = ALB_contact_the_shkreli_tribe }
					clr_country_flag = ALB_contact_the_shkreli_tribe
				}
				if = {
					limit = { has_country_flag = ALB_contact_the_kastrati_tribe }
					clr_country_flag = ALB_contact_the_kastrati_tribe
				}
				if = {
					limit = { has_country_flag = ALB_contact_the_gruda_tribe }
					clr_country_flag = ALB_contact_the_gruda_tribe
				}
				if = {
					limit = { has_country_flag = ALB_contact_the_shala_tribe }
					clr_country_flag = ALB_contact_the_shala_tribe
				}
				if = {
					limit = { has_country_flag = ALB_contact_the_mat_tribe }
					clr_country_flag = ALB_contact_the_mat_tribe
				}
			}
		}
	}
	on_offer_join_faction = {
		effect = {
			if = {
				limit = { ALB = { NOT = { has_rule = can_join_factions } } }
				ALB = { leave_faction = yes }
			}
		}
	}
	on_join_faction = {
		effect = {
			if = {
				limit = { ALB = { NOT = { has_rule = can_join_factions } } }
				ALB = { leave_faction = yes }
			}
		}
	}
	on_government_exiled = {
		effect = {
			if = {
				limit = { ALB = { NOT = { has_rule = can_join_factions } } }
				ALB = { leave_faction = yes }
			}
		}
	}
}
