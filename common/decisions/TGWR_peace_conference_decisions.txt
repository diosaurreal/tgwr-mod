GER_great_war = {
	#ENTENTE ASK FOR PEACE
	#######################
	FRA_armistice = {
		icon = GFX_decision_eng_trade_unions_support
		available = {
			has_civil_war = no
			has_global_flag = great_war
			OR = {
				surrender_progress > 0.10
				casualties > 600000
			}

			NOT = {
				has_global_flag = GER_capitulation
				has_global_flag = ENT_capitulation
			}
			is_faction_leader = yes
		}
		visible = {
			NOT = {
				has_global_flag = GER_capitulation
				has_global_flag = ENT_capitulation
			}
		}
		allowed = {
			tag = FRA		
		}
		visible = {
			has_country_flag = entente_leader
		}
		target_trigger = {
			FROM = {
				tag = GER
			}
		}
		target_root_trigger = {
			has_country_flag = entente_leader
			is_faction_leader = yes
		}
		fire_only_once = yes
		complete_effect = {
			set_country_flag = ask_for_peace
			if = {
				limit = {
					any_allied_country = {
						has_war_with = GER
						is_major = yes
						is_subject = no
						has_capitulated = no
						capital_scope = {
							is_on_continent = europe
						}
					}
				}
				set_global_flag = FRA_capitulation_alone
				country_event =  ww1_france.305
				else = {
					set_global_flag = ENT_capitulation
					FROM = {
						country_event = {
							id = ww1_entente_capitulation.1
							hours = 5
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 500
			# French won't gonna surrender with Paris
			modifier = {
				factor = 0
				tag = FRA
				controls_province = 11506
				has_capitulated = no
			}
			# French won't gonna surrender with the United States and major coastlines secured
			modifier = {
				factor = 0
				tag = FRA
				USA = {
					is_in_faction_with = PREV
					has_war_with = GER
					has_capitulated = no
				}
				AND = {
					controls_province = 9737 #Bordeaux
					controls_province = 11834 #Marseille
				}
				surrender_progress < 0.8
				has_capitulated = no
			}
			# French won't gonna surrender without massive casualties or losing territories
			modifier = {
				factor = 0
				tag = FRA
				has_capitulated = no
				casualties < 250000
				surrender_progress < 0.50
			}
			# game rule
			modifier = {
				factor = 0
				has_game_rule = {
					rule = allow_scripted_peace_treaty
					option = "BLOCKED"
				}
			}
		}
	}
	#ENTENTE WITHOUT FRANCE ASK FOR PEACE
	#######################
	RUS_sue_for_peace_GER = {
		name = FRA_armistice
		icon = GFX_decision_eng_trade_unions_support
		allowed = {
			tag = RUS
		}
		target_trigger = {
			FROM = { tag = GER }
		}
		visible = {
			has_global_flag = great_war
			has_war_with = FROM
			has_capitulated = no
			is_subject = no
			NOT = {
				tag = SOV
				country_exists = SOV
				has_global_flag = GER_capitulation
				has_global_flag = ENT_capitulation
				has_global_flag = great_war_ends
				has_global_flag = october_revolution
				has_global_flag = RUS_surrender_alone
			}
			FROM = {
				is_subject = no
				has_capitulated = no
			}
			has_war_with = FROM
			surrender_progress < 0.99 #prevent effect collide
		}
		target_root_trigger = {
			has_war_with = GER
		}
		available = {
			NOT = {
				has_active_mission = RUS_mission_tsar_abdication
				has_active_mission = RUS_threat_of_bolshevik_revolution
			}
			surrender_progress > 0.2
		}
		fire_only_once = yes
		ai_will_do = {
			factor = 400
			modifier = {
				factor = 0
				surrender_progress < 0.5
				has_war_support > 0.3
				is_in_faction_with = FRA
				FRA = { has_war_with = GER }
				NOT = { has_global_flag = FRA_surrender_alone }
			}
			modifier = {
				factor = 0
				surrender_progress < 0.3
			}
			modifier = {
				factor = 0
				has_game_rule = {
					rule = allow_scripted_peace_treaty
					option = "BLOCKED"
				}
			}
		}
		complete_effect = {
			if = {
				limit = {
					any_allied_country = {
						has_war_with = GER
						is_major = yes
						is_subject = no
						has_capitulated = no
						capital_scope = {
							is_on_continent = europe
						}
					}
				}
				FROM = {
					country_event = {
						id = ww1_russia.98
						hours = 5
					}	
				}
				else = {
					set_global_flag = ENT_capitulation
					FROM = {
						country_event = {
							id = ww1_entente_capitulation.1
							hours = 5
						}
					}
				}
			}
		}
	}
	ENT_armistice = {
		desc = FRA_armistice_desc
		icon = GFX_decision_eng_trade_unions_support
		allowed = {
			NOT = {
				tag = FRA
				tag = RUS
			}
		}
		available = {
			has_global_flag = great_war
			NOT = {
				has_global_flag = GER_capitulation
				has_global_flag = ENT_capitulation
				has_global_flag = honourable_peace
			}
		}
		visible = {
			tag = ENT
			NOT = {
				has_global_flag = GER_capitulation
				has_global_flag = ENT_capitulation
			}
		}
		target_trigger = {
			FROM = {
				tag = GER
			}
		}
		target_root_trigger = {
			has_country_flag = entente_leader
			is_faction_leader = yes
		}
		fire_only_once = yes
		complete_effect = {
			set_country_flag = ask_for_peace
			set_global_flag = ENT_capitulation
			set_global_flag = honourable_peace
			FROM = {
				country_event = {
					id = ww1_entente_capitulation.1
					hours = 5
				}
			}
		}
		ai_will_do = {
			base = 500
			### What if UK lead the faction ?
			# Well UK wont surrender since they are not alone in europe
			modifier = {
				factor = 0
				tag = ENG
				is_in_faction_with = FRA
				FRA = {
					is_in_faction_with = ROOT
					has_war_with = GER
					is_subject = no
					has_capitulated = no
					surrender_progress < 0.3
				}
				surrender_progress < 0.10
			}
			modifier = {
				factor = 0
				tag = ENG
				is_in_faction_with = RUS
				RUS = {
					is_in_faction_with = ROOT
					has_war_with = GER
					is_subject = no
					has_capitulated = no
					NOT = {
						has_country_flag = has_capitulated_with_france_early
						has_global_flag = RUS_surrender_alone
						tag = SOV
					}
					surrender_progress < 0.3
				}
				surrender_progress < 0.10
			}
			modifier = {
				factor = 0
				tag = ENG
				is_in_faction_with = ITA
				ITA = {
					is_in_faction_with = ROOT
					has_war_with = GER
					is_subject = no
					has_capitulated = no
					OR = {
						surrender_progress < 0.30
						AND = {
							war_length_with = {
								tag = GER
								months < 48
							}
							surrender_progress < 0.1
						}				
					}
				}
				surrender_progress < 0.10
			}
			# oh
			modifier = {
				factor = 0
				any_core_state = {
					any_neighbor_state = {
						is_core_of = owner
						owner = {
							OR = {
								tag = GER
								is_subject_of = GER
								is_in_faction_with = GER
							}
							has_war_with = ROOT
							has_capitulated = no
						}
					}
				}
				OR = {
					surrender_progress < 0.30
					AND = {
						war_length_with = {
							tag = GER
							months < 48
						}
						surrender_progress < 0.1
					}				
				}			
			}
			# there is a major ally in europe capable to keep war effort
			modifier = {
				factor = 0
				surrender_progress < 0.1
				any_allied_country = {
					is_major = yes
					any_core_state = {
						any_neighbor_state = {
							is_core_of = owner
							owner = {
								OR = {
									tag = GER
									is_subject_of = GER
									is_in_faction_with = GER
								}
								has_war_with = ROOT
								has_capitulated = no
							}
						}
					}
					OR = {
						surrender_progress < 0.30
						AND = {
							war_length_with = {
								tag = GER
								months < 48
							}
							surrender_progress < 0.1
						}				
					}
				}		
			}
			# there is a minor ally in europe that didn't give up
			modifier = {
				factor = 0
				surrender_progress < 0.1
				war_length_with = {
					tag = GER
					months < 48
				}
				any_allied_country = {
					is_major = no
					any_core_state = {
						any_neighbor_state = {
							is_core_of = owner
							owner = {
								OR = {
									tag = GER
									is_subject_of = GER
									is_in_faction_with = GER
								}
								has_war_with = ROOT
								has_capitulated = no
							}
						}
					}
					has_capitulated = no
				}		
			}
			modifier = {
				factor = 0
				# about to win
				GER = {
					surrender_progress > 0.15
				}
			}
			# game rule
			modifier = {
				factor = 0
				has_game_rule = {
					rule = allow_scripted_peace_treaty
					option = "BLOCKED"
				}
			}
		}
	}
	#ENTENTE - REFUSE TO SURRENDER
	member_of_entente_armistice = {
		icon = GFX_decision_generic_break_treaty
		available = {
			has_war_with = GER
			has_global_flag = ENT_capitulation
			NOT = {
				has_global_flag = frankfurt_armistice
			}
			is_subject = no
		}
		visible = {
			has_global_flag = great_war
			NOT = {
				has_global_flag = frankfurt_armistice
			}
			is_in_faction_with = ENT
			NOT = {
				tag = ENT
			}
		}
		target_trigger = {
			FROM = {
				tag = GER
			}
		}
		fire_only_once = yes
		complete_effect = {
			leave_faction = yes
			add_ai_strategy = {
				type = alliance
				id = ENT
				value = -2000
			}
			custom_effect_tooltip = refuse_to_surrender_tt
			hidden_effect = {
				every_country = {
					limit = {
						is_subject_of = ROOT
					}
					set_country_flag = refused_to_surrender
				}
			}
			set_country_flag = refused_to_surrender
			news_event = {
				id = ww1_entente_capitulation.4
			}
		}
		ai_will_do = {
			#Только для игроков.
			factor = 0
		}
	}
	#FRANKFURT ARMISTICE
	frankfurt_armistice_mission = {
		icon = GFX_decision_eng_trade_unions_support
		available = {
			custom_trigger_tooltip = {
				tooltip = frankfurt_armistice_signed
				has_global_flag = frankfurt_armistice
			}
		}
		allowed = {
			always = yes
		}
		days_mission_timeout = 10
		activation = {
			GER = {
				has_war_with = ENT
				has_global_flag = GER_accepts_ENT_capitulation
			}
		}
		visible = {
			OR = {
				has_country_flag = member_of_entente
				tag = GER
				has_country_flag = member_of_central_powers
				is_in_faction_with = GER
				has_country_flag = accepted_entente_surrender
				has_country_flag = FRA_surrender_alone
				has_country_flag = RUS_surrender_alone
			}
			has_global_flag = GER_accepts_ENT_capitulation
			NOT = { has_global_flag = frankfurt_armistice }
		}
		fire_only_once = yes
		is_good = no
		timeout_effect = {
			if = {
				limit = { tag = GER }
				set_global_flag = frankfurt_armistice
				set_global_flag = great_war_ends
				every_country = {
					limit = {
						has_war_with = ENT
						OR = {
							tag = GER
							is_in_faction_with = GER
							is_subject_of = GER
							has_country_flag = member_of_central_powers
							has_country_flag = accepted_entente_surrender
							has_subject = GER #austria
						}
						NOT = { has_country_flag = refused_to_surrender }
					}
					custom_effect_tooltip = get_great_war_winner
					if = {
						limit = {
							NOT = {
								AND = {
									is_subject = yes
									OR = {
										AND = {
											original_tag = LUX
											has_global_flag = luxembourg_submitted
										}
										has_country_flag = released_by_germany
									}									
								}
							}
						}
						set_country_flag = great_war_winner
					}
					add_ideas = idea_armistice
					every_other_country = {
						limit = {
							OR = {
								has_war = yes
								has_country_flag = FRA_surrender_alone
								has_country_flag = RUS_surrender_alone
							}
							OR = {
								has_country_flag = member_of_entente
								tag = ENT
								is_in_faction_with = ENT
								is_subject_of = ENT
								has_country_flag = FRA_surrender_alone
								has_country_flag = RUS_surrender_alone
							}
							NOT = {
								has_country_flag = refused_to_surrender
							}
						}
						custom_effect_tooltip = get_great_war_loser
						set_country_flag = great_war_loser
						add_ideas = idea_armistice
						white_peace = {
							tag = PREV
							message = frankfurt_armistice_message
						}
						set_truce = {
							target = PREV
							days = 365
						}
						# Army Restriction checker
						# i.e. you can't force usa or japan to restrict its army
						if = {
							limit = {
								OR = {
									has_capitulated = yes
									surrender_progress > 0.01
									casualties_inflicted_by = {
										opponent = PREV
										thousands > 1
									}
									any_home_area_neighbor_country = {
										is_major = yes
										has_country_flag = great_war_winner
									}
								}
							}
							if = {
								limit = {
									has_capitulated = yes
								}
								set_country_flag = has_capitulated_in_great_war
							}
							set_country_flag = army_should_be_restricted
						}
						# PEACE WITH NON-FACTIONAL ENEMIES
						# YOU CANNOT CONDUCT WAR ANYMORE SINCE YOU ARE GONNA LOST THE GREAT WAR
						# BUT THEY ARE NOT GONNA RECOGNISED AS VICTOR OF THE GREAT WAR
						every_other_country = {
							limit = {
								has_defensive_war_with = PREV
								is_in_faction = no
								is_subject = no
								has_civil_war = no
								NOT = {
									has_country_flag = member_of_entente
									has_country_flag = refused_to_surrender
								}
							}
							PREV = {
								white_peace = {
									tag = PREV
									message = frankfurt_armistice_message
								}
								set_truce = {
									target = PREV
									days = 365
								}
							}
						}
					}
				}
				add_named_threat = {
					name = frankfurt_armistice
					threat = -10
				}
				hidden_effect = { armistice_effect = yes }
			}
			else = {
				effect_tooltip = {
					add_named_threat = {
						name = frankfurt_armistice
						threat = -10
					}
				}
			}
		}
	}
	#FRANKFURT CONFERENCE
	frankfurt_conference = {
		icon = GFX_decision_eng_install_government
		available = {
			custom_trigger_tooltip = {
				tooltip = frankfurt_treaty_signed
				has_global_flag = frankfurt_treaty
			}
		}
		allowed = {
			always = yes
		}
		days_mission_timeout = 90
		activation = {
			GER = {
				has_global_flag = frankfurt_armistice
				OR = {
					has_country_flag = great_war_winner
					has_country_flag = great_war_loser
				}
			}
		}
		visible = {
			OR = {
				tag = ENT
				is_in_faction_with = ENT
				has_country_flag = member_of_entente
				tag = GER
				has_country_flag = member_of_central_powers
				has_country_flag = accepted_entente_surrender
				is_in_faction_with = GER
				has_country_flag = FRA_surrender_alone
				has_country_flag = RUS_surrender_alone
			}
			NOT = { has_global_flag = frankfurt_treaty }
			has_global_flag = frankfurt_armistice
		}
		fire_only_once = yes
		is_good = no
		timeout_effect = {
			if = {
				limit = { tag = GER }
				set_global_flag = frankfurt_treaty
				add_named_threat = {
					name = frankfurt_treaty
					threat = -30
				}
				hidden_effect = { conference_effect = yes }
			}
			else = {
				effect_tooltip = {
					add_named_threat = {
						name = frankfurt_treaty
						threat = -30
					}
				}
			}
		}
	}
	#CP CAPITULATION
	##################
	GER_armistice = {
		icon = GFX_decision_eng_trade_unions_support
		available = {
			has_global_flag = great_war
			GER = {
				has_war_with = ENT
				OR = {
					surrender_progress > 0.05
					has_idea = GER_famine
					has_war_support < 0.10
					has_stability < 0.10
				}
			}
			if = {
				limit = {
					has_war_with = USA
					USA = {
						is_subject = no
						has_government = democratic
					}
					surrender_progress < 0.2
				}
				custom_trigger_tooltip = {
					tooltip = USA_want_us_democratic
					has_government = democratic
				}
			}
			NOT = {
				has_global_flag = GER_capitulation
				has_global_flag = ENT_capitulation
			}
		}
		visible = {
			NOT = {
				has_global_flag = GER_capitulation
				has_global_flag = ENT_capitulation
			}
		}
		allowed = {
			tag = GER
		}
		target_trigger = {
			FROM = {
				has_country_flag = entente_leader
				is_faction_leader = yes
			}
		}
		fire_only_once = yes
		complete_effect = {
			set_global_flag = GER_capitulation
			FROM = {
				country_event = {
					id = ww1_centre_capitulation.1
					hours = 5
				}
			}
		}
		ai_will_do = {
			base = 0
			##basic surrendering
			modifier = {
				surrender_progress > 0.30
				casualties > 250000
				add = 1000
			}
			#WOW WHAT THE FUCK IS HAPPENING TO ME ?!
			modifier = {
				surrender_progress > 0.10
				has_war_with = RUS
				has_war_with = FRA
				has_war_with = USA
				has_war_with = AUS
				add = 1000
			}
			##historical trigger
			#Germany loses ton of soliders
			#France is not almost beaten at all
			#Britain is not almost beaten at all
			#USA is not almost beaten at all
			#German war effort is destroyed
			#The war last long
			modifier = {
				OR = {
					casualties > 1500000
					casualties_inflicted_by = {
						opponent = FRA
						thousands > 500
					}
				}
				
				FRA = {
					surrender_progress < 0.25
					has_war_with = GER
				}
				ENG = {
					surrender_progress < 0.25
					has_war_with = GER
				}
				USA = {
					surrender_progress < 0.25
					has_war_with = GER
				}
				has_idea = GER_famine
				AUS = {
					if = {
						limit = {
							is_in_faction_with = PREV
						}
						OR = {
							has_country_flag = collapse_of_austria_hungary_HUN
							has_capitulated = yes
							surrender_progress > 0.50
						}
					}
				}
				TUR = {
					if = {
						limit = {
							is_in_faction_with = PREV
						}
						OR = {
							has_capitulated = yes
							surrender_progress > 0.50
						}
					}
				}
				add = 1000
			}
			#same as above but with more causalities
			modifier = {
				casualties > 3000000
				FRA = {
					surrender_progress < 0.40
					has_war_with = GER
				}
				ENG = {
					surrender_progress < 0.40
					has_war_with = GER
				}
				USA = {
					surrender_progress < 0.40
					has_war_with = GER
				}
				has_idea = GER_famine
				AUS = {
					if = {
						limit = {
							is_in_faction_with = PREV
						}
						OR = {
							has_capitulated = yes
							surrender_progress > 0.15
						}
					}
				}
				TUR = {
					if = {
						limit = {
							is_in_faction_with = PREV
						}
						OR = {
							has_capitulated = yes
							surrender_progress > 0.15
						}
					}
				}
				add = 1000
			}
			## Schlieffen plan failed, its a nightmare !
			modifier = {
				casualties > 500000
				surrender_progress > 0.15
				FRA = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				BEL = {
					has_capitulated = no
					surrender_progress < 0.10
					has_war_with = GER
				}
				RUS = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				AUS = {
					if = {
						limit = {
							is_in_faction_with = PREV
						}
						OR = {
							has_capitulated = yes
							surrender_progress > 0.15
						}
					}
				}
				date < 1917.1.1
				add = 1000
			}
			## Russia is beating us !
			modifier = {
				casualties > 250000
				FRA = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				RUS = {
					surrender_progress < 0.05
					has_war_with = GER
				}
				64 = { #berlin
					is_controlled_by = RUS 
				}
				66 = { #breslau
					is_controlled_by = RUS
				}
				763 = { #konisberg
					is_controlled_by = RUS
				}
				surrender_progress > 0.20
				add = 1000
			}
			#Germany has no fight spirit
			# modifier = {
			# 	FRA = {
			# 		surrender_progress < 0.10
			# 		has_war_with = GER
			# 	}
			# 	OR = {
			# 		AND = {
			# 			FRA = {
			# 				surrender_progress < 0.25
			# 			}
			# 			ENG = {
			# 				surrender_progress < 0.25
			# 			}
			# 			has_war_support < 0.05
			# 			has_stability < 0.05
			# 			has_idea = GER_famine
			# 		}
			# 		AND = {
			# 			FRA = {
			# 				surrender_progress < 0.25
			# 			}
			# 			ENG = {
			# 				surrender_progress < 0.25
			# 			}
			# 			has_war_support < 0.01
			# 			has_stability < 0.01
			# 			casualties > 1000000
			# 		}
			# 	}
			# 	add = 1000
			# }
			#Germany has no fight spirit #2
			modifier = {
				longest_war_length > 61
				FRA = {
					surrender_progress < 0.20
					has_war_with = GER
				}
				OR = {
					AND = {
						has_war_support < 0.05
						has_stability < 0.05
						has_idea = GER_famine
					}
					AND = {
						has_war_support < 0.01
						has_stability < 0.01
						casualties > 1000000
					}
					AND = {
						OR = {
							has_war_support < 0.1
							has_stability < 0.1
						}
						casualties > 1500000
						has_idea = GER_famine
					}
				}
				add = 1000
			}
			#Germany has no fight spirit #3
			modifier = {
				longest_war_length > 51
				FRA = {
					surrender_progress < 0.35
					has_war_with = GER
				}
				has_war_support < 0.03
				has_stability < 0.03
				has_idea = GER_famine
				add = 1000
			}
			#Germany has no fight spirit #4
			modifier = {
				longest_war_length > 52
				FRA = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				OR = {
					has_war_support < 0.05
					has_stability < 0.05
				}
				has_idea = GER_famine
				add = 1000
			}
			#Germany has no fight spirit #5
			modifier = {
				longest_war_length > 52
				FRA = {
					surrender_progress < 0.40
					has_war_with = GER
				}
				has_war_support < 0.05
				has_stability < 0.05
				has_idea = GER_famine
				add = 1000
			}
			#Germany has no fight spirit #6
			modifier = {
				longest_war_length > 52
				casualties > 5000000 #5M lol
				FRA = {
					surrender_progress < 0.60
					has_war_with = GER
				}
				has_idea = GER_famine
				add = 1000
			}
			#Germany has no fight spirit #7
			modifier = {
				longest_war_length > 48
				casualties > 4000000
				FRA = {
					surrender_progress < 0.40
					has_war_with = GER
				}
				has_idea = GER_famine
				add = 1000
			}
			#Germany has no fight spirit #8
			modifier = {
				longest_war_length > 56
				casualties > 3000000
				FRA = {
					surrender_progress < 0.20
					has_war_with = GER
				}
				has_idea = GER_famine
				add = 1000
			}
			#German armistice historical trigger
			modifier = {
				GER = {
					OR = {
						has_idea = GER_famine
						has_stability < 0.05
						has_war_support < 0.05
					}
					longest_war_length > 50	#october-november 1918
					OR = {
						has_war_support < 0.25
						has_stability < 0.25
					}
					casualties > 1500000 # 2 million minimum
				}
				#Germany has not invaded UK or USA, or Japan...
				any_country = {
					is_major = yes
					has_war_with = ROOT
					is_in_faction_with = ENT
					has_capitulated = no
					surrender_progress < 0.20
				}
				FRA = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				ENG = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				USA = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				add = 1000
			}
			#German armistice historical trigger + austria collapsed
			modifier = {
				GER = {
					OR = {
						has_stability < 0.15
						has_war_support < 0.15
					}
					longest_war_length > 48	#mid 1918
				}
				AUS = {
					NOT = {
						is_in_faction_with = GER
					}
					has_country_flag = collapse_of_austria_hungary_HUN
				}
				#Germany has not invaded UK or USA, or Japan...
				any_country = {
					is_major = yes
					has_war_with = ROOT
					OR = {
						is_in_faction_with = FRA
						tag = FRA
					}
					has_capitulated = no
					surrender_progress < 0.20
				}
				add = 1000
			}
			#German armistice historical trigger if no USA
			modifier = {
				GER = {
					OR = {
						has_idea = GER_famine
						has_stability < 0.05
						has_war_support < 0.05
					}
					longest_war_length > 54	#early 1919
					OR = {
						has_war_support < 0.10
						has_stability < 0.10
					}
					casualties > 2000000 # 2 million minimum
				}
				#Germany has not invaded UK or USA, or Japan...
				any_country = {
					is_major = yes
					has_war_with = ROOT
					is_in_faction_with = FRA
					has_capitulated = no
					surrender_progress < 0.20
				}
				FRA = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				ENG = {
					surrender_progress < 0.10
					has_war_with = GER
				}
				add = 1000
			}
			# prevent vanilla chaos
			modifier = {
				add = 1000
				surrender_progress > 0.9
			}
			#historical revolution trigger in germany
			modifier = {
				add = 1000
				has_war_support < 0.8
				has_stability < 0.8
				has_idea = GER_famine
				has_global_flag = GER_1918_revolution
			}
			# game rule
			modifier = {
				factor = 0
				has_game_rule = {
					rule = allow_scripted_peace_treaty
					option = "BLOCKED"
				}
			}
		}
	}
	#COMPIEGNE ARMISTICE
	compiegne_armistice_mission = {
		icon = GFX_decision_eng_trade_unions_support
		available = {
			custom_trigger_tooltip = {
				tooltip = compiegne_armistice_signed
				has_global_flag = compiegne_armistice
			}
		}
		allowed = { always = yes }
		days_mission_timeout = 10
		activation = {
			ENT = {
				has_global_flag = ENT_accepts_GER_capitulation
				has_war_with = GER
			}
		}
		visible = {
			OR = {
				tag = ENT
				is_in_faction_with = ENT
				has_country_flag = member_of_entente
				tag = GER
				has_country_flag = member_of_central_powers
				is_in_faction_with = GER
				has_country_flag = accepted_german_surrender
				has_country_flag = FRA_surrender_alone
				has_country_flag = RUS_surrender_alone
			}
			has_global_flag = ENT_accepts_GER_capitulation
			NOT = {
				has_global_flag = compiegne_armistice
			}
		}
		fire_only_once = yes
		is_good = no
		timeout_effect = {
			if = {
				limit = {
					tag = ENT
				}
				set_global_flag = compiegne_armistice
				set_global_flag = great_war_ends
				every_country = {
					limit = {
						has_war_with = GER
						OR = {
							tag = ENT
							is_in_faction_with = ENT
							is_subject_of = ENT
							has_country_flag = member_of_entente
							has_country_flag = accepted_german_surrender
						}
						NOT = {
							has_country_flag = refused_to_surrender
						}
					}
					if = {
						limit = {
							is_arabian_peninsula_tag = no
						}
						set_country_flag = great_war_winner
						add_ideas = idea_armistice
					}		
					every_other_country = {
						limit = {
							has_war = yes
							OR = {
								is_in_faction_with = GER
								tag = GER
								is_subject_of = GER
								has_country_flag = member_of_central_powers
							}
							NOT = {
								has_country_flag = refused_to_surrender
							}
						}
						if = {
							limit = {
								NOT = {
									AND = {
										is_subject = yes
										OR = {
											has_country_flag = released_by_germany							
											tag = YEM
											tag = UAS
											AND = {
												original_tag = LUX
												has_global_flag = luxembourg_submitted
											}
										}
									}
								}
							}
							set_country_flag = great_war_loser
							add_ideas = idea_armistice
						}
						white_peace = {
							tag = PREV
							message = compiegne_armistice_message
						}
						set_truce = {
							target = PREV
							days = 365
						}
						# Army Restriction checker
						# i.e. you can't force usa or japan to restrict its army
						if = {
							limit = {
								OR = {
									has_capitulated = yes
									surrender_progress > 0.01
									casualties_inflicted_by = {
										opponent = PREV
										thousands > 1
									}
									any_home_area_neighbor_country = {
										is_major = yes
										has_country_flag = great_war_winner
									}
								}
							}
							if = {
								limit = {
									has_capitulated = yes
								}
								set_country_flag = has_capitulated_in_great_war
							}
							set_country_flag = army_should_be_restricted
						}
						if = {
							limit = { has_idea = GER_idea_german_military_advisors }
							remove_ideas = GER_idea_german_military_advisors
						}
						# PEACE WITH NON-FACTIONAL ENEMIES
						# YOU CANNOT CONDUCT WAR ANYMORE SINCE YOU ARE GONNA LOST THE GREAT WAR
						# BUT THEY ARE NOT GONNA RECOGNISED AS VICTOR OF THE GREAT WAR
						every_other_country = {
							limit = {
								has_defensive_war_with = PREV
								is_in_faction = no
								is_subject = no
								has_civil_war = no
								NOT = {
									has_country_flag = member_of_entente
									has_country_flag = refused_to_surrender
									tag = SOV
									AND = {
										is_russian_tag = yes
										has_war_with = SOV
									}
								}
							}
							PREV = {
								white_peace = {
									tag = PREV
									message = compiegne_armistice_message
								}
								set_truce = {
									target = PREV
									days = 365
								}
							}
						}
					}
				}
				add_named_threat = {
					name = compiegne_armistice
					threat = -10
				}
				hidden_effect = {
					armistice_effect = yes
				}
			}
			else = {
				effect_tooltip = {
					add_named_threat = {
						name = compiegne_armistice
						threat = -10
					}
				}
			}
		}
	}
	#CP - REFUSE TO SURRENDER
	member_of_centre_armistice = {
		icon = GFX_decision_generic_break_treaty
		available = {
			has_war_with = ENT
			has_global_flag = GER_capitulation
			NOT = {
				has_global_flag = compiegne_armistice
			}
			is_subject = no
		}
		visible = {
			has_global_flag = great_war
			NOT = {
				has_global_flag = compiegne_armistice
			}
			is_in_faction_with = GER
			NOT = {
				tag = GER
			}
			is_subject = no
		}
		target_trigger = {
			FROM = {
				has_country_flag = entente_leader
				is_faction_leader = yes
			}
		}
		fire_only_once = yes
		complete_effect = {
			leave_faction = yes
			GER = {
				add_ai_strategy = {
					type = alliance
					id = PREV
					value = -1000
				}
			}
			add_ai_strategy = {
				type = alliance
				id = GER
				value = -1000
			}
			set_country_flag = refused_to_surrender
			news_event = {
				id = ww1_centre_capitulation.4
			}
			custom_effect_tooltip = refuse_to_surrender_tt
			hidden_effect = {
				every_country = {
					limit = {
						is_subject_of = ROOT
					}
					set_country_flag = refused_to_surrender
				}
			}
		}
		ai_will_do = {
			#Только для игроков.
			factor = 0
		}
	}
	#VERSALLIES CONFERENCE
	versallies_conference = {
		icon = GFX_decision_eng_install_government
		available = {
			custom_trigger_tooltip = {
				tooltip = versailles_treaty_signed
				has_global_flag = versailles_treaty
			}
		}
		allowed = {
			always = yes
		}
		days_mission_timeout = 90
		activation = {
			ENT = {
				has_global_flag = compiegne_armistice
				OR = {
					has_country_flag = great_war_winner
					has_country_flag = great_war_loser
				}
			}
		}
		visible = {
			OR = {
				tag = ENT
				is_in_faction_with = ENT
				has_country_flag = member_of_entente
				tag = GER
				has_country_flag = member_of_central_powers
				is_in_faction_with = GER
				has_country_flag = accepted_german_surrender
				has_country_flag = FRA_surrender_alone
				has_country_flag = RUS_surrender_alone
			}
			NOT = {
				has_global_flag = versailles_treaty
			}
			has_global_flag = compiegne_armistice
		}
		fire_only_once = yes
		is_good = no
		timeout_effect = {
			if = {
				limit = { tag = ENT }
				set_global_flag = versailles_treaty
				add_named_threat = {
					name = versailles_treaty
					threat = -30
				}
				hidden_effect = { conference_effect = yes }
			}
			else = {
				effect_tooltip = {
					add_named_threat = {
						name = versailles_treaty
						threat = -30
					}
				}
			}
		}
	}
}
