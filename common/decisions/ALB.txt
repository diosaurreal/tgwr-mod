ALB_albanian_independence_movement = {
	ALB_organize_rebellion = {
		icon = GFX_decision_generic_prepare_civil_war
		allowed = { original_tag = ALB }
		custom_cost_text = 250_infantry_equipment_1
		custom_cost_trigger = { has_equipment = { infantry_equipment > 249 } }
		days_remove = 70
		cancel_trigger = { controls_state = FROM }
		state_target = yes
		target_trigger = {
			FROM = {
				OR = {
					ALB_is_kosovar_state = yes
					ALB_is_northern_state = yes
					ALB_is_central_state = yes
					ALB_is_southern_state = yes
				}
				NOT = {
					is_owned_by = ROOT
					is_controlled_by = ROOT
				}
			}
		}
		visible = {
			OR = {
				NOT = { has_dynamic_modifier = { modifier = ALB_albanian_society_bad } }
				AND = {
					has_dynamic_modifier = { modifier = ALB_albanian_society_bad }
					capital_scope = { ALB_is_kosovar_state = yes }
					OR = {
						FROM = { ALB_is_kosovar_state = yes }
						AND = {
							has_country_flag = ALB_can_uprising_in_north
							FROM = { ALB_is_northern_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_centre
							FROM = { ALB_is_central_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_south
							FROM = { ALB_is_southern_state = yes }
						}
					}
				}
				AND = {
					has_dynamic_modifier = { modifier = ALB_albanian_society_bad }
					capital_scope = { ALB_is_northern_state = yes }
					OR = {
						FROM = { ALB_is_northern_state = yes }
						AND = {
							has_country_flag = ALB_can_uprising_in_kosova
							FROM = { ALB_is_kosovar_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_centre
							FROM = { ALB_is_central_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_south
							FROM = { ALB_is_southern_state = yes }
						}
					}
				}
				AND = {
					has_dynamic_modifier = { modifier = ALB_albanian_society_bad }
					capital_scope = { ALB_is_central_state = yes }
					OR = {
						FROM = { ALB_is_central_state = yes }
						AND = {
							has_country_flag = ALB_can_uprising_in_kosova
							FROM = { ALB_is_kosovar_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_north
							FROM = { ALB_is_northern_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_south
							FROM = { ALB_is_southern_state = yes }
						}
					}
				}
				if = {
					has_dynamic_modifier = { modifier = ALB_albanian_society_bad }
					capital_scope = { ALB_is_southern_state = yes }
					OR = {
						FROM = { ALB_is_southern_state = yes }
						AND = {
							has_country_flag = ALB_can_uprising_in_kosova
							FROM = { ALB_is_kosovar_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_north
							FROM = { ALB_is_northern_state = yes }
						}
						AND = {
							has_country_flag = ALB_can_uprising_in_centre
							FROM = { ALB_is_central_state = yes }
						}
					}
				}
			}
		}
		on_map_mode = map_only
		complete_effect = {
			hidden_effect = {
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = -250
				}
				if = {
					limit = {
						FROM = {
							controller = {
								intel_level_over = { 
									target = ALB
									civilian_intel > 0.2
								}
							}
						}
					}
					FROM = { controller = { activate_mission = other_organize_rebellion } }
				}
				if = {
					limit = {
						FROM = {
							controller = {
								intel_level_over = { 
									target = ALB
									civilian_intel > 0.5
								}
							}
						}
					}
					FROM = { controller = { country_event = albania.7 } }
				}
				FROM = { set_variable = { global.albanian_resistance_state = THIS } }
			}
		}
		remove_effect = {
			effect_tooltip = {
				FROM = {
					add_resistance = 25
					add_compliance = -2
				}
			}
			custom_effect_tooltip = ALB_albanian_independence_movement_tt
			if = {
				limit = { any_enemy_country = { divisions_in_state = { state = FROM size > 3 } } }
				FROM = {
					add_resistance = 5
					add_compliance = -10
				}
			}
			else_if = {
				limit = { any_enemy_country = { divisions_in_state = { state = FROM size > 2 } } }
				FROM = {
					add_resistance = 10
					add_compliance = -8
				}
			}
			else_if = {
				limit = { any_enemy_country = { divisions_in_state = { state = FROM size > 1 } } }
				FROM = {
					add_resistance = 15
					add_compliance = -6
				}
			}
			else_if = {
				limit = { any_enemy_country = { divisions_in_state = { state = FROM size > 0 } } }
				FROM = {
					add_resistance = 20
					add_compliance = -4
				}
			}
			else_if = {
				limit = { any_enemy_country = { divisions_in_state = { state = FROM size < 1 } } }
				FROM = {
					add_resistance = 25
					add_compliance = -2
				}
			}
			clear_variable = global.albanian_resistance_state
		}
		cancel_effect = { hidden_effect = { clear_variable = global.albanian_resistance_state } }
		ai_will_do = {
			base = 50
			modifier = {
				has_idea = TUR_naval_blockade
				factor = 15
			}
		}
	}
	other_organize_rebellion = {
		icon = GFX_decision_generic_prepare_civil_war
		allowed = { NOT = { original_tag = ALB } }
		activation = { always = no }
		days_mission_timeout = 70
		cancel_trigger = { ALB = { controls_state = var:global.albanian_resistance_state } }
		state_target = yes
		target_trigger = { FROM = { state = var:global.albanian_resistance_state } }
		on_map_mode = map_only
		visible = { controls_state = var:global.albanian_resistance_state }
		available = { hidden_trigger = { always = no } }
		timeout_effect = {
			effect_tooltip = {
				var:global.albanian_resistance_state = {
					add_resistance = 25
					add_compliance = -2
				}
				custom_effect_tooltip = ALB_albanian_independence_movement_tt
				if = {
					limit = {
						var:global.albanian_resistance_state = {
							controller = {
								intel_level_over = { 
									target = ALB
									civilian_intel > 0.3
								}
							}
						}
					}
					if = {
						limit = { ROOT = { divisions_in_state = { state = var:global.albanian_resistance_state size > 3 } } }
						var:global.albanian_resistance_state = {
							add_resistance = 5
							add_compliance = -10
						}
					}
					else_if = {
						limit = { ROOT = { divisions_in_state = { state = var:global.albanian_resistance_state size > 2 } } }
						var:global.albanian_resistance_state = {
							add_resistance = 10
							add_compliance = -8
						}
					}
					else_if = {
						limit = { ROOT = { divisions_in_state = { state = var:global.albanian_resistance_state size > 1 } } }
						var:global.albanian_resistance_state = {
							add_resistance = 15
							add_compliance = -6
						}
					}
					else_if = {
						limit = { ROOT = { divisions_in_state = { state = var:global.albanian_resistance_state size > 0 } } }
						var:global.albanian_resistance_state = {
							add_resistance = 20
							add_compliance = -4
						}
					}
					else_if = {
						limit = { ROOT = { divisions_in_state = { state = var:global.albanian_resistance_state size < 1 } } }
						var:global.albanian_resistance_state = {
							add_resistance = 25
							add_compliance = -2
						}
					}
				}
				else = { custom_effect_tooltip = other_albanian_independence_movement_tt }
			}
		}
		cancel_effect = { hidden_effect = { clear_variable = global.albanian_resistance_state } }
	}
}

political_actions = {
	#failsafe
	#for when northern epirus defeats albania
	EPR_restore_albania = {
		allowed = {
			original_tag = EPR
		}
		visible = {
			is_subject = no
			OR = {
				controls_state = 44
				controls_state = 871
				controls_state = 1214
				controls_state = 1215
			}
		}
		available = {
			has_capitulated = no
			has_war = no
			44 = {
				is_owned_by = ROOT
				is_fully_controlled_by = ROOT
			}
			803 = {
				is_owned_by = ROOT
				is_fully_controlled_by = ROOT
			}
			871 = {
				is_owned_by = ROOT
				is_fully_controlled_by = ROOT
			}
			1214 = {
				is_owned_by = ROOT
				is_fully_controlled_by = ROOT
			}
			1215 = {
				is_owned_by = ROOT
				is_fully_controlled_by = ROOT
			}
			NOT = {
				country_exists = ALB
			}
		}
		fire_only_once = no
		complete_effect = {
			every_owned_state = {
				limit = {
					is_core_of = ALB
					NOT = {
						is_core_of = ROOT
						state = 803
					}
				}
				transfer_state_to = ALB
			}
			set_autonomy = {
				target = ALB
				autonomy_state = autonomy_dominion
			}
		}
	}
}
