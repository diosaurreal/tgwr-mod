PER_market_workshop = {


	set_temp_variable = { PER.PER_var_change_finer = PER.PER_var_workshop }
	subtract_from_temp_variable = { PER.PER_var_change_finer = PER.PER_var_changer_workshop }
	add_to_variable = {
		var = PER.PER_var_changer_workshop
		value = PER.PER_var_change_finer
	}
	
	#### industrial goods ####
	add_to_variable = {
		var = PER.PER_var_goods
		value = PER.PER_var_change_finer
	}
	
	#### rural sosiety ####
	
	#PER.PER_psd -10%
	#PER.PER_pfef -10%
	#PER.PER_cgf 40%
	#PER.PER_rsf -30%
	
	set_temp_variable  = {
		var = PER.PER_var_change_finer_1
		value = PER.PER_var_change_finer
	}
	divide_temp_variable  = {
		var = PER.PER_var_change_finer_1
		value = 38750
	}
	set_temp_variable  = {
		var = PER.PER_var_change_finer_2
		value = PER.PER_var_change_finer
	}
	divide_temp_variable  = {
		var = PER.PER_var_change_finer_2
		value = 38750
	}
	set_temp_variable  = {
		var = PER.PER_var_change_finer_3
		value = PER.PER_var_change_finer
	}
	divide_temp_variable  = {
		var = PER.PER_var_change_finer_3
		value = 9687.5
	}
	set_temp_variable  = {
		var = PER.PER_var_change_finer_4
		value = PER.PER_var_change_finer
	}
	divide_temp_variable  = {
		var = PER.PER_var_change_finer_4
		value = 12916
	}
	
	add_to_variable = {
		var = PER.PER_psd
		value = PER.PER_var_change_finer_1
	}
	add_to_variable = {
		var = PER.PER_pfef
		value = PER.PER_var_change_finer_2
	}
	subtract_from_variable = {
		var = PER.PER_cgf
		value = PER.PER_var_change_finer_3
	}
	add_to_variable = {
		var = PER.PER_rsf
		value = PER.PER_var_change_finer_4
	}
	
	clamp_variable = {
		var = PER.PER_psd
		max = 0
		min = -0.125
	}
	clamp_variable = {
		var = PER.PER_pfef
		max = 0
		min = -0.125
	}
	clamp_variable = {
		var = PER.PER_cgf
		max = 0.5
		min = 0
	}
	clamp_variable = {
		var = PER.PER_rsf
		max = 0
		min = -0.375
	}
	
	if = {
		limit = {
			check_variable = {
				PER.PER_var_workshop > 4999
			}
		}
		set_variable = { PER.PER_psd = 0 }
		set_variable = { PER.PER_pfef = 0 }
		set_variable = { PER.PER_cgf = 0 }
		set_variable = { PER.PER_rsf = 0 }
	}
	
	####### factory #######
	
	set_variable = { PER.PER_var_change_finer_facotry = PER.num_of_civilian_factories }
	subtract_from_variable = { PER.PER_var_change_finer_facotry = PER.PER_var_changer_factorries }
	add_to_variable = {
		var = PER.PER_var_changer_factorries
		value = PER.PER_var_change_finer_facotry
	}
	multiply_variable = { PER.PER_var_change_finer_facotry = 150 }
	add_to_variable = {
		var = PER.PER_var_workshop
		value = PER.PER_var_change_finer_facotry
	}
	set_variable = { PER.PER_var_change_finer_facotry = 0 }
	
	##### goods #####
	
	
	set_variable = { PER.PER_farm_change_finer = PER.PER_farm }
	subtract_from_variable = { PER.PER_farm_change_finer = PER.PER_farm_changer }
	add_to_variable = {
		var = PER.PER_farm_changer
		value = PER.PER_farm_change_finer
	}
	multiply_variable = { PER.PER_farm_change_finer = 50 }
	add_to_variable = {
		var = PER.PER_var_goods
		value = PER.PER_farm_change_finer
	}
	set_variable = { PER.PER_farm_change_finer = 0 }
	
	#### goods per capta ####
	
	set_variable = { PER.PER_persian_population = PER.max_manpower_k }
	
	divide_variable = {
		var = PER.PER_persian_population
		value = 100
	}
	
	set_variable = { PER.PER_var_goods_per_capta = PER.PER_var_goods }
	
	divide_variable = {
		var = PER.PER_var_goods_per_capta
		value = PER.PER_persian_population
	}

	multiply_variable = {
		var = PER_var_goods_per_capta
		value = 100
	}
	
	#### trade import ####
	
	set_variable = { PER.PER_var_import_goods = 100 }
	
	subtract_from_variable = { PER.PER_var_import_goods = PER.PER_var_goods_per_capta }
	
	subtract_from_variable = { PER.PER_var_import_goods = PER.PER_var_domestic_production_support }
	
	clamp_variable = {
		var = PER.PER_var_import_goods
		min = 0
		max = 100
	}

	#### total goods ####
	
	set_variable = { PER.PER_var_total_goods = PER.PER_var_goods_per_capta }
	
	add_to_variable = {
		var = PER.PER_var_total_goods
		value = PER.PER_var_import_goods
	}
	
	#### Foreign influence market ####
	
	set_variable = { PER.PER_FIMme = PER.PER_Foreign_influence_market }
	divide_variable = {
		var = PER.PER_FIMme
		value = 100
	}
	
	set_variable = { PER.PER_FIMtof = PER.PER_Foreign_influence_market }
	divide_variable = {
		var = PER.PER_FIMtof
		value = 100
	}
	
	set_variable = { PER.PER_FIMcito = PER.PER_Foreign_influence_market }
	divide_variable = {
		var = PER.PER_FIMcito
		value = 5
	}
	
	#### decrease foreign influence by goods ####
	
	set_variable = { PER.PER_Foreign_influence_market = PER.PER_var_import_goods }
	subtract_from_variable = { PER.PER_Foreign_influence_market = PER.PER_var_anti_foreign_influnce }
	
	#has_idea = PER_civil_defnece
	
	if = {
		limit  = {
			NOT = {
				PER = {
					has_dynamic_modifier = {
						modifier = PER_idea_foreign_reliance
					}
				}
			}	
		}
		PER = {
			divide_variable = {
				var = PER.PER_Foreign_influence_market
				value = 2
			}
		}
	}
	
	clamp_variable = {
		var = PER.PER_Foreign_influence_market
		max = 100
		min = 0
	}
	
	#### crisis by not Goods enough ####
	
	set_variable = { PER.PER_var_crisis_by_Ngoods = PER.PER_var_total_goods }
	subtract_from_variable = { PER.PER_var_crisis_by_Ngoods = 100 }
	
	##
	
	divide_variable = {
		var = PER.PER_var_crisis_by_Ngoods
		value = 100
	}
	
	set_variable = { PER.PER_PMsf = PER.PER_var_crisis_by_Ngoods }
	
	## dept ##
	
	set_variable = { PER.PER_var_Dept_changed = PER.PER_var_Dept }
	divide_variable = {
		var = PER.PER_var_Dept_changed
		value = 100
	}
	
	#### workshops bankup ####
	
	set_variable = { PER.PER_var_workshop_bankup = PER.PER_Foreign_influence_market }
	multiply_variable = {
		var = PER.PER_var_workshop_bankup
		value = 3
	}
	divide_variable = {
		var = PER.PER_var_workshop_bankup
		value = 10
	}
	round_variable = PER.PER_var_workshop_bankup
	
	#### export income ####
	
	
	#PER_var_posetivee : posetive_export
	#PER_var_posef : posetive_export_finder
	#PER_var_pec : posetive_export_changer
	

		
		set_variable = { PER.PER_var_posetive_export = PER.PER_var_total_goods }
		
		set_variable = { PER.PER_var_posetive_export_finder = PER.PER_var_posetive_export }
		
		subtract_from_variable = { PER.PER_var_posetive_export_finder = PER.PER_var_posetive_export_changer }
	
		add_to_variable = {
			var = PER.PER_var_posetive_export_changer
			value = PER.PER_var_posetive_export_finder
		}
		
		divide_variable = {
			var = PER.PER_var_posetive_export_finder
			value = 200
		}
		
	if = {
	
		limit = {
			#check_variable = { PER.PER_var_total_goods > 100 }
			var = PER.PER_var_total_goods
			value = 100
			compare = greater_than
		}
		
		add_to_variable = {
			var = PER.PER_PMpfef
			value = PER.PER_var_posetive_export_finder
		}
		add_to_variable = {
			var = PER.PER_PMpfme
			value = PER.PER_var_posetive_export_finder
		}
		add_to_variable = {
			var = PER.PER_PMcons
			value = PER.PER_var_posetive_export_finder
		}
		subtract_from_variable = {
			var = PER.PER_PMcgf
			value = PER.PER_var_posetive_export_finder
		}
		
		set_variable = { PER.PER_var_posetive_export_finder = 0 }
		
	}
	
	
	
	
	
	
	
	#### limits ####
	
	clamp_variable = {
		var = PER.PER_var_domestic_production_support
		max = 100
		min = -100
	}
	
	#clamp_variable = {
	#	var = PER.PER_PMcgf
	#	min = -0.6
	#}
}
